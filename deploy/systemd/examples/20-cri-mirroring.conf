## CRI Mirroring Support Drop-in
## Install this file to /etc/systemd/system/harbor-satellite.service.d/20-cri-mirroring.conf
## ONLY if you need container runtime mirroring (--mirrors flag)
##
## WARNING: This drop-in significantly relaxes security restrictions
## - Grants CAP_SYS_ADMIN and CAP_DAC_OVERRIDE capabilities
## - Allows writing to CRI configuration directories
## - Permits systemctl access to restart Docker/containerd
##
## Only install if you are using the --mirrors flag for CRI configuration
## After installing: sudo systemctl daemon-reload

[Service]
# Grant filesystem write access for CRI config files
ReadWritePaths=/etc/docker /etc/containerd /etc/containers /etc/crio /run/systemd/system

# Grant capabilities needed for systemctl and config file manipulation
CapabilityBoundingSet=CAP_SYS_ADMIN CAP_DAC_OVERRIDE

# Disable private user namespace (systemctl needs root namespace)
PrivateUsers=no

# Allow privileged system calls needed for service management
SystemCallFilter=@system-service
